(function(e){function o(){t(),r()}function t(){const o=e("#post_ID").val();c({type:"get-collection",module:o},function(e){!0===e.success&&(d=e.data,n())})}function c(o,t){e.ajax({type:"POST",url:WPCloudplugin_AdminUI_vars.ajax_url,data:{action:"useyourdrive-proofing-dashboard",_ajax_nonce:WPCloudplugin_AdminUI_vars.admin_nonce,...o},dataType:"json",success:t,error:function(){window.showNotification(!1,WPCloudplugin_AdminUI_vars.str_ajax_request_failed)}})}function n(){d.users.length>0&&h.empty(),i(),l([],[]),e("#loading-overlay").fadeOut(1e3,function(){e(this).remove()})}function i(){const o=e("#wpcp-proof-collection-filter-people");d.users.length>0&&o.empty(),d.users.forEach(e=>{o.append(f(e))});const t=e("#wpcp-proof-collection-filter-labels");d.labels.length>0&&t.empty(),d.labels.forEach(e=>{t.append(w(e))});const c=e("#wpcp-proof-collection-selections");d.users.length>0&&c.empty(),d.users.forEach(e=>{c.append(m(e))})}function l(e,o){g=d.items.filter(t=>{const c=0===e.length||e.some(e=>t.users.some(o=>String(o)===String(e))),n=0===o.length||o.some(e=>t.labels.includes(e));return c&&n}),a(),p(),s()}function p(){const o={},t={};d.users.forEach(e=>o[e.id]=0),d.labels.forEach(e=>t[e.id]=0),g.forEach(e=>{e.users.forEach(e=>o[e]=(o[e]||0)+1),e.labels.forEach(e=>t[e]=(t[e]||0)+1)}),e(".wpcp-proof-filter-list[data-user-id]").each(function(){const t=e(this).find("input").val();e(this).find(".counter").text("("+(o[t]||0)+")")}),e(".wpcp-proof-filter-list[data-label-id]").each(function(){const o=e(this).find("input").val();e(this).find(".counter").text("("+(t[o]||0)+")")});const c=e(".wpcp-proof-collection-select-assets");c.find("span").text(c.attr("data-button-text").replace("%s",g.length))}function s(){if(b=[],e(".wpcp-proof-collection-item.wpcp-selected").not(":visible").removeClass("wpcp-selected"),e(".wpcp-proof-collection-item.wpcp-selected:visible").each(function(){b.push(e(this).attr("id"))}),0===b.length)return void v.fadeOut();v.find(".wpcp-proof-collection-status-bar-selected-assets").text(b.length),v.fadeIn();const o=e(".wpcp-proof-collection-item.wpcp-selected").map(function(){return e(this).attr("data-filename")}).get().join(",");e("#wpcp-modal-export-filenames").val(o)}function a(){d.items.forEach(e=>{const o=h.find(`[data-id="${e.id}"]`);g.includes(e)?o.length?o.show():h.append(u({item:e,labels:d.labels.filter(function(o){return e.labels.includes(o.id)})})):o.length&&o.hide()})}function r(){e("#wpcp").on({change:function(o){const t=e(".wpcp-proof-filter-user:checked").map(function(){return e(this).val()}).get(),c=e(".wpcp-proof-filter-label:checked").map(function(){return e(this).val()}).get();l(t,c)}},".wpcp-proof-filter"),e("#wpcp").on({click:function(o){e(".wpcp-proof-filter").prop("checked",!1),e(".wpcp-proof-collection-item").removeClass("wpcp-selected"),l([],[])}},".wpcp-proof-collection-filter-reset");var o,t,n=20,i=50;e("#wpcp").selectable({classes:{"ui-selectee":"wpcp-selectee","ui-selecting":"wpcp-selecting","ui-selected":"wpcp-selected","ui-selectable-helper":"wpcp wpcp-selectable-helper"},filter:"li.wpcp-proof-collection-item",start:function(c,l){function p(o){var t=e(window).scrollTop(),c=e(window).height(),i=e(document).height();"down"===o?t<i-c&&e(window).scrollTop(t+n):"up"===o&&t>0&&e(window).scrollTop(t-n)}var s=!1;e(window).on("mousemove",function(c){e(window).scrollTop();var n=e(window).height(),l=c.clientY;l>n-i?s||(s=!0,o=requestAnimationFrame(function e(){p("down"),l>n-i&&(o=requestAnimationFrame(e))})):l<i?s||(s=!0,t=requestAnimationFrame(function e(){p("up"),l<i&&(t=requestAnimationFrame(e))})):(s=!1,cancelAnimationFrame(o),cancelAnimationFrame(t))})},stop:function(c,n){e(window).off("mousemove"),cancelAnimationFrame(o),cancelAnimationFrame(t),s()}}),e("#wpcp").on({click:function(o){e(this).toggleClass("wpcp-selected"),s()}},".wpcp-proof-collection-item"),e("#wpcp").on({click:function(o){e(".wpcp-proof-collection-item.wpcp-selected").removeClass("wpcp-selected"),e(".wpcp-proof-collection-item:visible").addClass("wpcp-selected"),s()}},".wpcp-proof-collection-select-assets"),e("#wpcp").on({click:function(o){e(".wpcp-proof-collection-item").removeClass("wpcp-selected"),s()}},".wpcp-proof-collection-deselect-assets"),e("#wpcp").on({click:function(o){const t=e("#post_ID").val();c({type:"add_user_selection",module:t,email:e("#wpcp-proof-collection-add-user-email").val()},function(e){!0===e.success?(window.showNotification(!0,WPCloudplugin_AdminUI_vars.str_selection_add_user_success),window.location.reload()):window.showNotification(!1,WPCloudplugin_AdminUI_vars.str_selection_add_user_failed)})}},".wpcp-proof-collection-add-user"),e("#wpcp").on({click:function(e){return e.stopPropagation(),!0}},".wpcp-open-link"),e("#wpcp").on({click:function(o){const t=e("#post_ID").val(),n=e(this).closest("[data-selection-ident]"),i=n.attr("data-selection-ident");c({type:"delete-selection",module:t,ident:i},function(e){!0===e.success?(window.showNotification(!0,WPCloudplugin_AdminUI_vars.str_selection_deleted_success),window.location.reload()):window.showNotification(!1,WPCloudplugin_AdminUI_vars.str_selection_deleted_failed)})}},".wpcp-proof-collection-delete-selection"),e("#wpcp").on({change:function(o){const t=e("#post_ID").val(),n=e(this).closest("[data-selection-ident]"),i=n.attr("data-selection-ident"),l=e(this),p=e(this).parent("button"),s=p.children(".wpcp-input-checkbox-button-container"),a=s.children(".wpcp-input-checkbox-button-off"),r=s.children(".wpcp-input-checkbox-button-on"),d=e(this).prop("checked");d?(p.removeClass("bg-gray-200").addClass("bg-brand-color-900"),s.removeClass("translate-x-0").addClass("translate-x-4"),a.removeClass("opacity-100 ease-in duration-200").addClass("opacity-0 ease-out duration-100"),r.removeClass("opacity-0 ease-out duration-100").addClass("opacity-100 ease-in duration-200")):(p.addClass("bg-gray-200").removeClass("bg-brand-color-900"),s.addClass("translate-x-0").removeClass("translate-x-4"),a.addClass("opacity-100 ease-in duration-200").removeClass("opacity-0 ease-out duration-100"),r.addClass("opacity-0 ease-out duration-100").removeClass("opacity-100 ease-in duration-200")),c({type:"set-approval",module:t,ident:i,approved:d},function(e){!0===e.success?window.showNotification(!0,e.data.approved?WPCloudplugin_AdminUI_vars.str_selection_set_approval_approved_success:WPCloudplugin_AdminUI_vars.str_selection_set_approval_open_success):(window.showNotification(!1,WPCloudplugin_AdminUI_vars.str_selection_set_approval_failed),l.prop("checked",!l.prop("checked")))})}},'.wpcp-proof-collection-toggle-approved input[type="checkbox"]'),e("#wpcp").on({click:function(o){const t=e(this).find('input[type="checkbox"]');t.prop("checked",!t.prop("checked")).trigger("change")}},".wpcp-proof-collection-toggle-approved"),e("#wpcp").on({click:function(o){e("#wpcp-modal-export").fadeOut()}},".wpcp-proof-copy-filenames"),new ClipboardJS("#wpcp .wpcp-copy-to-clipboard",{text:function(o){return e(e(o).attr("data-input")).val()}}).on("success",function(e){window.showNotification(!0,WPCloudplugin_AdminUI_vars.str_copied_to_clipboard),e.clearSelection()}).on("error",function(){window.prompt("Copy to clipboard: Ctrl+C, Enter",e(e(this).attr("data-input")).val())})}let d={};const u=_.template(e("#wpcp-proof-collection-item-template").html()),f=_.template(e("#wpcp-proof-collection-filter-people-template").html()),w=_.template(e("#wpcp-proof-collection-filter-label-template").html()),m=_.template(e("#wpcp-proof-collection-selection-item-template").html()),h=e("#wpcp-proof-collection-items"),v=e("#wpcp-proof-collection-status-bar");let g=[],b=[];o()})(jQuery);