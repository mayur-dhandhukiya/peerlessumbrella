(function(e){function t(t,a){let o=e("table"),n=t.index(),d=o.find("tbody tr").get();d.sort(function(t,o){let d=e(t).children("td").eq(n).text().toUpperCase(),i=e(o).children("td").eq(n).text().toUpperCase();return"ASC"===a?d<i?-1:d>i?1:0:d>i?-1:d<i?1:0}),e.each(d,function(e,t){o.children("tbody").append(t)})}function a(t){e.ajax({url:UseyourDrive_vars.ajax_url,method:"POST",dataType:"json",data:{action:"useyourdrive-duplicate-module",post:t,_ajax_nonce:WPCloudplugin_AdminUI_vars.admin_nonce},success:function(e){!0===e.success?window.location.href=UseyourDrive_vars.ajax_url+"?action=useyourdrive-getpopup&type=shortcodebuilder&foruploadfield="+b+"&callback="+g+"&module="+e.data.ID:window.showNotification(!1,UseyourDrive_vars.str_module_updated_failed)},error:function(e){window.showNotification(!1,UseyourDrive_vars.str_module_updated_failed)}})}function o(t){e("#wpcp-button-save-shortcode").addClass("disabled").prop("disabled",!0),e.ajax({url:UseyourDrive_vars.ajax_url,method:"POST",dataType:"json",data:{action:"useyourdrive-save-module",post:t,_ajax_nonce:WPCloudplugin_AdminUI_vars.admin_nonce},success:function(a){!0===a.success?(window.showNotification(!0,UseyourDrive_vars.str_module_updated_success),t.post_content&&a.data&&a.data.post_content&&(e("[data-full-shortcode]").data("full-shortcode",WPCP_shortcodeEncode(a.data.post_content)),i())):window.showNotification(!1,UseyourDrive_vars.str_module_updated_failed)},error:function(e){window.showNotification(!1,UseyourDrive_vars.str_module_updated_failed)},complete:function(){e("#wpcp-button-save-shortcode").removeClass("disabled").prop("disabled",!1)}})}function n(t){e.ajaxQueue.addRequest({url:UseyourDrive_vars.ajax_url,method:"POST",dataType:"json",data:{action:"useyourdrive-get-module-location",module_ids:t,_ajax_nonce:WPCloudplugin_AdminUI_vars.admin_nonce},success:function(a){t.forEach(function(t){e('tr[data-module-id="'+t+'"] .wpcp-module-path').text("")}),a.data.forEach(function(t){const a=t.data.module_id;!0!==t.success&&e('tr[data-module-id="'+a+'"]').addClass("bg-red-50"),t.data&&t.data.path&&e('tr[data-module-id="'+a+'"] .wpcp-module-path').text(t.data.path),t.data&&t.data.account_email&&e('tr[data-module-id="'+a+'"] .wpcp-module-account-email').text(t.data.account_email)})},error:function(){e('tr[data-module-id="'+moduleId+'"]').addClass("bg-red-50")}}),e.ajaxQueue.run()}function d(t){v=t,e("#wpcp").attr("data-mode","wpcp-module-"+v),e("#wpcp .wpcp-module-classes[data-nav-tab]").not(".wpcp-module-all").attr("disabled","disabled").addClass("hidden"),e("#wpcp .wpcp-module-classes[data-nav-tab].wpcp-module-"+v).attr("disabled","").removeClass("hidden"),e("#wpcp [data-nav-panel] .wpcp-module-classes").not(".wpcp-module-all").addClass("hidden"),e("#wpcp [data-nav-panel] .wpcp-module-classes.wpcp-module-"+v).not(".wpcp-module-all").removeClass("hidden"),e("[data-nav-panel]").each(function(){e(this).find(".wpcp-panel:not(.hidden) .wpcp-panel-header").first().trigger("click")}),"files"===t||("upload"===t?e('input[name="upload"]').prop("checked",!0).trigger("change"):"gallery"===t||("audio"===t?e('input[name="singleaccount"]').prop("checked",!0).trigger("change"):"video"===t&&e('input[name="singleaccount"]').prop("checked",!0).trigger("change")));let a=e('#wpcp input[name="mode"]:checked').parent().next(),o=e("#wpcp-module-icon"),n=a.clone().attr("id","wpcp-module-icon");n.addClass("-mr-2").addClass("rounded-l-md").removeClass("rounded-lg"),o.replaceWith(n),e('[data-nav-tab="wpcp-content"]').trigger("click")}function i(){let t=WPCP_shortcodeEncode(l()),a=e("[data-full-shortcode]").data("full-shortcode");if(t===a)return e("#wpcp-button-save-shortcode").hide(),e("#wpcp-button-pick-shortcode, #wpcp-button-back").show(),void(window.onbeforeunload=null);e("#wpcp-button-save-shortcode").show(),e("#wpcp-button-pick-shortcode, #wpcp-button-back").hide(),window.onbeforeunload=function(){return!0}}function c(t){let a=1,o={};if(t.origin!==window.location.origin)return;if("object"!=typeof t.data||null===t.data||void 0===t.data.action)return;if("wpcp-select-entries"!==t.data.action)return;if("useyourdrive"!==t.data.slug)return;let n=e(t.data.element_id).parents(".wpcp-items-selector"),d=n.find(".wpcp-selected-items"),i=d.find("table tbody"),c=i.find("tr.wpcp-selected-item-template");t.data.entries.forEach(function(t,n,d){if(!(a>0&&Object.entries(o).length>=a)){if(e('.wpcp-module[data-account-id="'+t.account_id+'"] .entry[data-id="'+t.entry_id+'"]').addClass("is-selected"),0===i.find('tr[data-account-id="'+t.account_id+'"][data-entry-id="'+t.entry_id+'"]').length){let e=c.clone();e.removeClass("wpcp-selected-item-template hidden"),e.attr("data-account-id",t.account_id),e.attr("data-entry-id",t.entry_id),e.find(".wpcp-selected-item-name").text(t.entry_name),e.find(".wpcp-selected-item-icon").attr("src",t.entry_icon_url),i.append(e)}r()}})}function r(){e(".wpcp-module[data-action='selector']").find(".entry.is-selected").removeClass("is-selected");const t=e("#items-selected-items").find("tr.wpcp-selected-item").toArray();t.forEach(function(t,a,o){const n=e(t).attr("data-entry-id"),d=e(t).attr("data-account-id");e('.wpcp-module[data-action="selector"][data-account-id="'+d+'"] .entry[data-id="'+n+'"]').addClass("is-selected")}),i()}function p(e){window.top.postMessage({slug:"useyourdrive",action:"wpcp-shortcode",shortcode:e},window.location.origin),""!==g&&("function"==typeof window.parent[g]?window.parent[g](e):"function"==typeof window.top[g]&&window.top[g](e))}function l(){var t=e(".wpcp-module-all").find('input[type="text"], input[type="number"], input[type="checkbox"], input[type="radio"]:checked, option:selected'),a=e(".wpcp-module-"+v).find('input[type="text"], input[type="number"], input[type="checkbox"], input[type="radio"]:checked, option:selected');t=t.add(a);var o=t.filter(function(){var t=e(this);return e.inArray(t.attr("name"),["mode","viewrole"])>=0||!t.hasClass("wpcp-folder-selector-current")&&((!1!==t.closest(".wpcp-module-classes").hasClass("wpcp-module-"+v)||!1!==t.closest(".wpcp-module-classes").hasClass("wpcp-module-all"))&&((!t.parents(".wpcp-toggle-panel").length||"none"!==t.parents(".wpcp-toggle-panel").css("display"))&&u(t)!=m(t)))}),n="[useyourdrive ",d=[];if(d.mode=u(e('input[name="mode"]')),"1"===u(e('input[name="singleaccount"]'))&&(d.dir=u(e('input[name="dir[id]"]')),d.account=u(e('input[name="dir[account]"]'))),"manual"===u(e('input[name="userfolders"]:checked'))&&(delete d.account,delete d.dir),"list"===v||"embed"===v||"button"===v){delete d.dir;var i=[];e(".wpcp-selected-items tbody tr:not(.wpcp-selected-item-template)").each(function(){d.account=e(this).attr("data-account-id");let t=e(this).attr("data-entry-id");i.push(t)}),d.items=i.map(e=>e).join("|")}for(var c in o.each(function(){e(this).is("option")?d[e(this).parent().attr("name")]=u(e(this)):d[e(this).attr("name")]=u(e(this))}),"dir"in d&&(d.dir=d.dir.replace("[","%5B").replace("]","%5D")),"download"in d&&(delete d.download,d.downloadrole="none"),"preview"in d&&(delete d.preview,d.previewrole="none"),"use_usertemplatedir"in d&&(delete d.use_usertemplatedir,d.usertemplatedir=u(e('input[name="usertemplatedir[id]"]'))),"userfoldernametemplate"in d&&""==d.userfoldernametemplate&&delete d.userfoldernametemplate,"upload"==d.mode&&"editdescription"in d&&(d.upload_auto_start="0"),("use_password"in d||""==d.accessibility_password_panel)&&delete d.use_password,""==d.proofing_labels&&delete d.proofing_labels,d)n+=c+'="'+d[c]+'" ';return n+="]",e("#wpcp-raw-shortcode-preview").val(n),n}function s(t){e("input[name='showplaylist']").prop("checked",!1).trigger("change"),e("input[name='include']").val(t.data("id"));var a=t.find(".entry_link:first").data("name"),o=["mp4","m4v","ogg","ogv","webmv"],n=["mp3","m4a","oga","wav","webm"];n.forEach(function(t){if(a.indexOf("."+t)>=0)return e("input#mode-audio").trigger("click"),!1}),o.forEach(function(t){if(a.indexOf("."+t)>=0)return e("input#mode-video").trigger("click"),!1});var d=l();!1!==d&&p(d)}function u(e){return e.hasClass("wpcp-tagify")?h(e):"checkbox"===e.attr("type")?e.parents("fieldset").length?w(e.parents("fieldset")):e.prop("checked")?"1":"0":"radio"===e.attr("type")?e.data("value"):"number"===e.attr("type")?""!==e.val()?e.val():e.data("default-value"):e.val().toString().replace(/"/g,"'")}function m(e){return e.is("option")?e.parent().data("default-value"):"checkbox"===e.attr("type")?e.parents("fieldset").length?e.parents("fieldset").data("default-value"):"true"===e.data("default-value")||1==e.data("default-value")?"1":"0":"radio"===e.attr("type")?e.parents("fieldset").data("default-value"):e.data("default-value")}function f(t){var a=t.find(":checked").map(function(){return e(this).data("value")}).get();return a}function w(e){var t=f(e);return 0===t.length?"none":t.length===e.length?"all":t.join("|")}function h(t){var a=t.val();if("permissions"!==t.attr("data-tagify-whitelist"))return""===a?"":JSON.parse(a).map(e=>e.value).join("|");if(0===a.length)return"none";var o=[];return e.each(JSON.parse(a),function(e,t){o.push(t.id)}),o.indexOf("none")>-1?"none":o.indexOf("all")>-1?"all":o.join("|")}let v,g=e("body[data-callback]").data("callback"),_=new URLSearchParams(window.location.search),b=_.has("foruploadfield")?_.get("foruploadfield"):"0";e(".wpcp-select-module, #wpcp-button-pick-shortcode").on("click",function(t){t.preventDefault(),t.stopPropagation();let a=WPCP_shortcodeDecode(e(this).closest("[data-shortcode]").data("shortcode"));p(a)}),e(".wpcp-edit-module").on("click",function(t){t.preventDefault(),t.stopPropagation();let a=e(this).parents("tr").attr("data-module-id");window.location.href=UseyourDrive_vars.ajax_url+"?action=useyourdrive-getpopup&type=shortcodebuilder&foruploadfield="+b+"&callback="+g+"&module="+a}),e("#wpcp-button-save-shortcode").on("click",function(t){t.preventDefault(),t.stopPropagation();let a=e("body").data("module-id"),n=l();!1!==n&&o({ID:a,post_content:n})}),e(".wpcp-duplicate-module").on("click",function(t){t.preventDefault(),t.stopPropagation();let o=e(this).closest("[data-module-id]").data("module-id");a({ID:o})}),e(".wpcp-delete-module").on("click",function(t){let a=e(this),o=a.closest(".wpcp-existing-module");o.fadeOut(),t.stopPropagation(),e.ajax({url:a.data("url"),method:"GET",success:function(e){window.showNotification(!0,UseyourDrive_vars.str_module_deleted_success),o.remove()},error:function(e){window.showNotification(!1,UseyourDrive_vars.str_module_deleted_failed),o.fadeIn()}})}),e(".wpcp-proofing-edit").on("click",function(t){window.top.location.href=e(this).attr("href")}),e("#wpcp-module-name").on("change",function(){let t=e("body").data("module-id"),a=e("#wpcp-module-name").val();o({ID:t,post_title:a})}),e(".wpcp-input-checkbox-button").on("click",function(e){e.preventDefault(),e.stopPropagation()}),e(".wpcp-toggle-status").on("change",function(){let t=e(this).closest("[data-module-id]").data("module-id"),a=e(this).is(":checked")?"publish":"draft";o({ID:t,post_status:a})}),e(".wpcp-copy-shortcode").on("click",function(t){t.preventDefault(),t.stopPropagation();let a=e("<input>");e("body").append(a),a.val(WPCP_shortcodeDecode(e(this).parents("[data-shortcode]").data("shortcode"))).select(),document.execCommand("copy"),a.remove(),window.showNotification(!0,UseyourDrive_vars.str_copied_to_clipboard)}),e("#wpcp").on({click:function(t){var a=e("<input>");e("body").append(a),a.val(e("#wpcp-raw-shortcode-preview").val()).select(),document.execCommand("copy"),a.remove(),window.showNotification(!0,UseyourDrive_vars.str_copied_to_clipboard)}},"#wpcp-copy-raw-shortcode"),e("#wpcp").on({click:function(t){t.stopPropagation(),s(e(this).closest(".entry"))}},".entry-embed-item"),e("#wpcp").on({click:function(t){l(),e(e(this).data("dialog-id")).fadeIn()}},"#wpcp-button-create-shortcode"),e("#wpcp").on({click:function(t){e(this).prop("disabled",!0).addClass("disabled");let a=e("#wpcp-raw-shortcode-preview").val();var o=a.replace("</p>","").replace("<p>","");let n=WPCP_shortcodeEncode(o),d=new URL(window.location);var i=new URLSearchParams(d.search);window.location.href=UseyourDrive_vars.ajax_url+"?action=useyourdrive-getpopup&type="+i.get("type")+"&foruploadfield="+b+"&callback="+g+"&"+n}},"#wpcp-button-import-shortcode"),e(".wpcp-view-module").on("click",function(e){return e.stopPropagation(),!0}),e(".wpcp-sort-order-button").on("click",function(a){a.preventDefault(),a.stopPropagation();let o=e(this).parents("th"),n="ASC"===o.attr("data-sort-order")?"DESC":"ASC";t(o,n),e(".wpcp-sort-order-icon-desc").hide(),e(".wpcp-sort-order-icon-asc").hide(),"ASC"===n?e(this).find(".wpcp-sort-order-icon-asc").show():e(this).find(".wpcp-sort-order-icon-desc").show(),o.attr("data-sort-order",n)});let y=e('tr [data-module-path-loaded="0"]').map(function(){return e(this).closest("[data-module-id]").data("module-id")}).get();y.length&&n(y),e("#wpcp").on({change:function(){d(e(this).data("value"))}},'input[name="mode"]'),e('#wpcp input[name="mode"]:checked').trigger("change"),e('input[name="download"]').on({change:function(){!0===e(this).prop("checked")?e('[data-nav-tab="wpcp-usage_limits"]').attr("disabled","").removeClass("disabled"):e('[data-nav-tab="wpcp-usage_limits"]').attr("disabled","disabled").addClass("disabled")}}).trigger("change"),e('input[name="upload"]').on({change:function(){!0===e(this).prop("checked")?e('[data-nav-tab="wpcp-upload"]').attr("disabled","").removeClass("disabled"):e('[data-nav-tab="wpcp-upload"]').attr("disabled","disabled").addClass("disabled")}}).trigger("change"),e('input[name="moduleId"]').on({keyup:function(){e(this).val(e(this).val().replace(/\W/g,"_"))}}),"upload-field"===e("body").data("configuration")&&e('input[name="mode"]').not("#mode-files, #mode-upload").prop("disabled",!0).parent().parent().hide(),""!==e('input[name="usertemplatedir[id]"]').val()&&e('input[name="use_usertemplatedir"]').prop("checked",!0).trigger("change"),""!==e('input[name="password"]').val()&&e('input[name="use_password"]').prop("checked",!0).trigger("change"),e('input[name="userfolders"]').on({change:function(){"manual"===u(e('input[name="userfolders"]:checked'))?e('[data-nav-tab="wpcp-content"]').attr("disabled","disabled").addClass("disabled"):e('[data-nav-tab="wpcp-content"]').attr("disabled","").removeClass("disabled")}}).trigger("change"),e('#wpcp [data-menu-panel="wpcp-module-builder"]').on({change:i,keyup:i},"input, select, textarea"),e("#wpcp-button-save-shortcode").hide(),e(".wpcp-module").on("wpcp-content-loaded",function(e,t){var a=t.element.parents(".wpcp-folder-selector");a.length&&(a.find(".wpcp-folder-selector-input-name, .wpcp-folder-selector-current").val(t.raw_path).trigger("change"),a.find(".wpcp-folder-selector-input-account").val(t.element.attr("data-account-id")).trigger("change"),a.find(".wpcp-folder-selector-input-id").val(t.element.attr("data-id")).trigger("change"))}),e(".wpcp-module").one("ajax-error",function(){e('[data-nav-tab="wpcp-content"]').trigger("click"),e("#wpcp-modal-missing-content").fadeIn()}),e(".wpcp-selected-items").on({click:function(t){t.preventDefault(),e(this).parents("tr").remove(),r()}},".wpcp-remove-selected-item"),window.top.addEventListener("message",c),e(".wpcp-module[data-action='selector']").on("wpcp-content-loaded",function(e,t){r()}),e("#enjoying-button-lets-ask-no").on("click",function(t){e(".enjoying-container.lets-ask").fadeOut("fast",function(){e(".enjoying-container.mwah").fadeIn()})}),e("#enjoying-button-lets-ask-yes").on("click",function(t){e(".enjoying-container.lets-ask").fadeOut("fast",function(){e(".enjoying-container.go-for-it").fadeIn()})}),e("#enjoying-button-mwah-no, #enjoying-button-go-for-it-no, #enjoying-button-go-for-it-yes, #enjoying-button-mwah-yes").click(function(){e.ajax({type:"POST",url:UseyourDrive_vars.ajax_url,data:{action:"useyourdrive-rating-asked"}})})})(jQuery);