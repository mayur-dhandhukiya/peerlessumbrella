jQuery(document).ready(function(e){"use strict";e.widget("cp.wpcp_reports",{options:{$container_totals:e("#wpcp-counter-totals"),$container_events_chart:e("#wpcp-events-chart"),$container_top_previews:e("#top-previews"),$container_top_downloads:e("#top-downloads"),$container_top_users:e("#top-users"),$container_top_usage:e("#top-usage"),$container_latest_uploads:e("#latest-uploads"),$container_top_uploads:e("#top-uploads"),$users_log:e("#users-log"),$container_full_log:e("#full-log")},chartjs:null,_create:function(){this._initiate()},_destroy:function(){return this._super()},_setOption:function(e,t){this._super(e,t)},_initiate:function(){let e=this;this._initChartDatePicker(),this._initChart(),this.options.$container_totals.one("inview",function(t,a){e.loadTotalsData(e.options.$container_totals,null,null)}),this.options.$container_events_chart.one("inview",function(t,a){e.loadChartData()}),this.options.$container_top_previews.one("inview",function(t,a){e.loadTopPreviews()}),this.options.$container_top_downloads.one("inview",function(t,a){e.loadTopDownloads()}),this.options.$container_top_users.one("inview",function(t,a){e.loadTopUsers()}),this.options.$container_top_usage.one("inview",function(t,a){e.loadTopUsage()}),this.options.$container_latest_uploads.one("inview",function(t,a){e.loadLatestUploads()}),this.options.$container_top_uploads.one("inview",function(t,a){e.loadTopUploads()}),this.options.$users_log.one("inview",function(t,a){e.loadUsersLog()}),this.options.$container_full_log.one("inview",function(t,a){e.loadFullLog()}),this._initEvents()},_initEvents:function(){let t=this;e(t.element).on("click","a.open-entry-details",function(a){var n=e(this).data("entry-id"),o=e(this).data("account-id");t.viewEntryDetails(n,o)}),e(t.element).on("click","a.open-user-details",function(a){var n=e(this).data("user-id");t.viewUserDetails(n)}),e(t.element).on("click","#clear_statistics",function(e){t.clearStatistics()})},clearStatistics:function(){let t=this,a=e("#clear_statistics");a.prop("disabled",!0).addClass("disabled"),e.ajax({method:"POST",url:t.options.ajax_url,data:{action:"useyourdrive-reset-statistics",_ajax_nonce:t.options.admin_nonce},complete:function(){a.prop("disabled",!1).removeClass("disabled"),location.reload()},dataType:"json"})},_initChartDatePicker:function(){let e=this;var t=e.element.find(".date_range_selector");e.date_range_selector=t.flatpickr({defaultDate:["today",moment().subtract(1,"months").toDate()],dateFormat:"d-m-Y",mode:"range",showMonths:2,onValueUpdate:function(t,a,n){clearTimeout(e.updateChartTimer),e.updateChartTimer=setTimeout(function(){e.loadTotalsData(e.options.$container_totals,null,null),e.loadChartData(),e.topPreviews.ajax.reload(),e.topDownloads.ajax.reload(),e.topUsers.ajax.reload(),e.topUsage.ajax.reload(),e.topUploads.ajax.reload(),e.latestUploads.ajax.reload(),e.usersLog.ajax.reload(),e.fullLog.ajax.reload()},1e3)}})},loadChartData:function(){let t=this;t.options.$container_events_chart.prev().fadeIn(),t.chartjs.reset(),e.ajax({method:"POST",url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"activities",periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e){t.chartjs.data=e,t.chartjs.update()},complete:function(e){t.options.$container_events_chart.prev().fadeOut()},dataType:"json"})},_initChart:function(){let e=this;e.chartjs=new Chart(e.options.$container_events_chart,{type:"line",options:{fill:!0,tension:.3,responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{mode:"index",position:"nearest"}},scales:{x:{type:"time",beginAtZero:!1,time:{parser:"DD-MM-YYYY",unit:"day",tooltipFormat:"LL"},title:{display:!1}},y:{beginAtZero:!1,title:{display:!1}}}}})},loadTotalsData:function(t,a,n){let o=this;t.find(".wpcp-counter span").css({"background-color":"",color:""}),e.ajax({method:"POST",url:o.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"totals",detail:a,id:n,periodstart:null===a?moment(o.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"):null,periodend:null===a?moment(o.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"):null,_ajax_nonce:o.options.admin_nonce},success:function(e){o._setTotalsData(t,e)},complete:function(e){t.find(".loading").fadeOut()},dataType:"json"})},_setTotalsData:function(t,a){e.each(t.find(".wpcp-counter"),function(){var t=e(this).data("type");if(e(this).html('<div class="loading" style="display: none;"><div class="wpcp-loading-beat"></div></div>'),void 0===a[t])return e(this).append("0"),!0;var n=parseInt(a[t].total);e(this).css({"background-color":a[t].colors.normal,color:"white"}).append(n)})},loadTopPreviews:function(){let t=this;t.topPreviews=t.options.$container_top_previews.DataTable({dom:'Bfrtp<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:25,searching:!1,responsive:{details:{type:"column",target:-1}},buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"toppreviews",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - Previews per File.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""}],columns:[{data:"icon"},{data:"entry_name"},{data:"total"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:!1,orderable:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.entry_id+'"><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"entry_name",targets:1,className:"all dt-left",responsivePriority:1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.entry_id+'" title="'+a.parent_path+"/"+a.entry_name+'" class="open-entry-details" data-entry-id="'+a.entry_id+'" data-account-id="'+a.account_id+'">'+a.entry_name+"</a>"}},{name:"total",targets:2,width:"30px",className:"dt-right",render:function(e,t,a,n){return e}}],order:[[2,"desc"]],processing:!0,serverSide:!1,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="toppreviews",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadTopDownloads:function(){let t=this;t.topDownloads=t.options.$container_top_downloads.DataTable({dom:'Bfrtp<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:25,searching:!1,responsive:{details:{type:"column",target:-1}},buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"topdownloads",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - Downloads per File.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""}],columns:[{data:"icon"},{data:"entry_name"},{data:"total"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:!1,orderable:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.entry_id+'"><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"entry_name",targets:1,className:"all dt-left",responsivePriority:1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.entry_id+'" title="'+a.parent_path+"/"+a.entry_name+'" class="open-entry-details" data-entry-id="'+a.entry_id+'" data-account-id="'+a.account_id+'">'+a.entry_name+"</a>"}},{name:"total",targets:2,width:"30px",className:"dt-right",render:function(e,t,a,n){return e}}],order:[[2,"desc"]],processing:!0,serverSide:!1,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="topdownloads",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadTopUsers:function(){let t=this;t.topUsers=t.options.$container_top_users.DataTable({dom:'Bfrtp<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:25,searching:!1,responsive:{details:{type:"column",target:-1}},buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"topusers",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - Downloads per User.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""}],columns:[{data:"icon"},{data:"user_display_name"},{data:"total"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:!1,orderable:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.user_id+'" class="open-user-details" data-user-id="'+a.user_id+'" ><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"user_display_name",targets:1,className:"all dt-left",responsivePriority:1,render:function(e,t,a,n){return"display"!==t?e:"0"===a.user_id?e:'<a href="#'+a.user_id+'" class="open-user-details" data-user-id="'+a.user_id+'">'+e+"</a>"}},{name:"total",targets:2,width:"30px",className:"dt-right",render:function(e,t,a,n){return e}}],order:[[2,"desc"]],processing:!0,serverSide:!1,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="topusers",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadTopUsage:function(){let t=this;t.topUsage=t.options.$container_top_usage.DataTable({dom:'Bfrtp<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:25,searching:!1,responsive:{details:{type:"column",target:-1}},buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"topusage",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - Bandwidth Usage.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""}],columns:[{data:"icon"},{data:"user_display_name"},{data:"total"},{data:"total_bytes"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:!1,orderable:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.user_id+'" class="open-user-details" data-user-id="'+a.user_id+'" ><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"user_display_name",targets:1,className:"all dt-left",responsivePriority:1,render:function(e,t,a,n){return"display"!==t?e:"0"===a.user_id?e:'<a href="#'+a.user_id+'" class="open-user-details" data-user-id="'+a.user_id+'">'+e+"</a>"}},{name:"total",targets:2,width:"30px",className:"dt-right",orderData:[3,2],render:function(e,t,a,n){return e}},{name:"total_bytes",targets:3,width:"30px",className:"dt-right",visible:!1,render:function(e,t,a,n){return e}}],order:[[2,"desc"]],processing:!0,serverSide:!1,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="topusage",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadLatestUploads:function(){let t=this;t.latestUploads=t.options.$container_latest_uploads.DataTable({dom:'Bfrtp<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:25,searching:!1,responsive:{details:{type:"column",target:-1}},buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"latestuploads",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - Latest Uploads.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""}],columns:[{data:"icon"},{data:"entry_name"},{data:"datetime"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:!1,orderable:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.entry_id+'"><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"entry_name",targets:1,className:"all dt-left",responsivePriority:1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.entry_id+'" title="'+a.parent_path+"/"+a.entry_name+'" class="open-entry-details" data-entry-id="'+a.entry_id+'" data-account-id="'+a.account_id+'">'+a.entry_name+"</a>"}},{name:"datetime",targets:2,width:"200px",className:"dt-right",render:function(e,t,a,n){return e}}],order:[[2,"desc"]],processing:!0,serverSide:!0,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="latestuploads",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadTopUploads:function(){let t=this;t.topUploads=t.options.$container_top_uploads.DataTable({dom:'Bfrtp<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:25,searching:!1,responsive:{details:{type:"column",target:-1}},buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"topuploads",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - Total Uploads per User.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""}],columns:[{data:"icon"},{data:"user_display_name"},{data:"total"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:!1,orderable:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.user_id+'" class="open-user-details" data-user-id="'+a.user_id+'" ><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"user_display_name",targets:1,className:"all dt-left",responsivePriority:1,render:function(e,t,a,n){return"display"!==t?e:"0"===a.user_id?e:'<a href="#'+a.user_id+'" class="open-user-details" data-user-id="'+a.user_id+'">'+e+"</a>"}},{name:"total",targets:2,width:"30px",className:"dt-right",render:function(e,t,a,n){return e}}],order:[[2,"desc"]],processing:!0,serverSide:!1,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="topuploads",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadUsersLog:function(){let t=this;t.usersLog=t.options.$users_log.DataTable({dom:'Bfrtp<"clear">',language:{loadingRecords:'<div class="loading"><div class="loader-beat"></div></div>',processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:50,searching:!1,buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"users-log",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - Events per User.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""}],columns:[{data:"icon"},{data:"user_display_name"},{data:"previews"},{data:"downloads"},{data:"uploads"}],columnDefs:[{name:"icon",targets:0,orderable:!1,width:"24px",className:"dt-left all",searchable:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.entry_id+'"><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"user_display_name",targets:1,className:"all dt-left",responsivePriority:1,render:function(e,t,a,n){return"display"!==t?e:"0"===a.user_id?e:'<a href="#'+a.user_id+'" class="open-user-details" data-user-id="'+a.user_id+'">'+e+"</a>"}},{name:"previews",targets:2,className:"dt-center",visible:!0,render:function(e,t,a,n){return e}},{name:"downloads",targets:3,className:"dt-center",visible:!0,render:function(e,t,a,n){return e}},{name:"uploads",targets:4,className:"dt-center",visible:!0,render:function(e,t,a,n){return e}}],order:[[1,"asc"]],processing:!0,serverSide:!1,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="users-log",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadFullLog:function(){let t=this;t.fullLog=t.options.$container_full_log.DataTable({dom:'Bfrtip<"clear">',language:{loadingRecords:'<div class="loading"><div class="loader-beat"></div></div>',processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollX:!0,scrollY:768,scroller:!0,scrollCollapse:!0,initComplete:function(e){e.api.scroller.measure(!0)},pageLength:50,searchDelay:600,buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(a,n,o,s){e.ajax({url:t.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"full-log",export:!0,periodstart:moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),periodend:moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),_ajax_nonce:t.options.admin_nonce},success:function(e,t,a){var n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.setAttribute("download","["+(new Date).toLocaleString()+"] Report - All Events Report.csv"),s.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""},{extend:"colvis",text:'<i class="eva eva-funnel-outline eva-lg"></i>',className:"wpcp-button-primary",background:!1,columns:[1,2,3,4,5,6,7,8,9]}],columns:[{data:"icon"},{data:"datetime"},{data:"description"},{data:"type"},{data:"user"},{data:"entry_name"},{data:"parent_path"},{data:"module_id"},{data:"location"},{data:"extra"}],columnDefs:[{name:"icon",targets:0,orderable:!1,width:"24px",className:"dt-left all",searchable:!1,render:function(e,t,a,n){return"display"!==t?e:"<i class='eva "+e+" eva-lg'></i>"}},{name:"datetime",targets:1,width:"200px",className:"dt-left all",render:function(e,t,a,n){return e}},{name:"description",targets:2,className:"dt-left",searchable:!1,render:function(e,t,a,n){return e}},{name:"type",targets:3,className:"all",visible:!1,render:function(e,t,a,n){return e}},{name:"user",targets:4,className:"dt-left",visible:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.user_id+'" class="open-user-details"  data-user-id="'+a.user_id+'">'+e+"</a>"}},{name:"entry_name",targets:5,className:"dt-left",visible:!1,render:function(e,t,a,n){return e}},{name:"parent_path",targets:6,className:"dt-left",visible:!1,render:function(e,t,a,n){return e}},{name:"module_id",targets:7,className:"dt-left",visible:!0,render:function(e,a,n,o){return"display"!==a?e:""===e?"":'<a href="'+t.options.modules_url+"&module="+e+'" target="_blank"><i class="eva eva-external-link-outline"></i> '+e+"</a>"}},{name:"location",targets:8,className:"dt-left",visible:!0,render:function(e,t,a,n){return"display"!==t?e:""===e?"":'<a href="'+a.location_full+'" target="_blank"><i class="eva eva-external-link-outline"></i> '+e+"</a>"}},{name:"extra",targets:9,width:"200px",className:"dt-left",visible:!1,render:function(e,t,a,n){return e}}],order:[[1,"desc"]],processing:!0,serverSide:!0,ajax:{url:t.options.ajax_url,data:function(e){e.action="useyourdrive-event-stats",e.type="full-log",e.periodstart=moment(t.date_range_selector.selectedDates[0]).format("YYYY-MM-DD"),e.periodend=moment(t.date_range_selector.selectedDates[1]).format("YYYY-MM-DD"),e._ajax_nonce=t.options.admin_nonce}}})},loadDetailedLog:function(t,a,n){let o=this;t.DataTable({dom:'fBrtp<"clear">',language:{loadingRecords:'<div class="loading"><div class="loader-beat"></div></div>',processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:!0,deferRender:!0,scrollY:300,scroller:!0,pageLength:50,searchDelay:600,responsive:!0,buttons:[{text:'<i class="eva eva-download-outline eva-lg"></i>',className:"wpcp-button-primary",action:function(t,s,r,i){e.ajax({url:o.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"full-log",detail:a,id:n,export:!0,_ajax_nonce:o.options.admin_nonce},success:function(e,t,a){var o=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=window.URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.setAttribute("download","[Report]"+(new Date).toLocaleString()+" All Events for user #"+n+".csv"),r.click()}})}},{extend:"copy",text:'<i class="eva eva-copy-outline eva-lg"></i>',className:"wpcp-button-primary"},{extend:"print",text:'<i class="eva eva-printer-outline eva-lg"></i>',className:"wpcp-button-primary",title:""},{extend:"colvis",text:'<i class="eva eva-funnel-outline eva-lg"></i>',className:"wpcp-button-primary",background:!1,columns:[1,2,3,4,5,6,7,8]}],columns:[{data:"icon"},{data:"datetime"},{data:"description"},{data:"type"},{data:"user"},{data:"entry_name"},{data:"parent_path"},{data:"location"},{data:"extra"}],columnDefs:[{name:"icon",targets:0,orderable:!1,width:"24px",className:"dt-left all",searchable:!1,render:function(e,t,a,n){return"display"!==t?e:"<i class='eva "+e+" eva-lg'></i>"}},{name:"datetime",targets:1,width:"200px",className:"dt-left all",render:function(e,t,a,n){return e}},{name:"description",targets:2,className:"dt-left",searchable:!1,render:function(e,t,a,n){return e}},{name:"type",targets:3,className:"all",visible:!1,render:function(e,t,a,n){return e}},{name:"user",targets:4,className:"dt-left",visible:!1,render:function(e,t,a,n){return"display"!==t?e:'<a href="#'+a.user_id+'" class="open-user-details"  data-user-id="'+a.user_id+'">'+e+"</a>"}},{name:"entry_name",targets:5,className:"dt-left",visible:!1,render:function(e,t,a,n){return e}},{name:"parent_path",targets:6,className:"dt-left",visible:!1,render:function(e,t,a,n){return e}},{name:"location",targets:7,className:"dt-left",visible:!1,render:function(e,t,a,n){return"display"!==t?e:""===e?"":'<a href="'+a.location_full+'" target="_blank"><i class="eva eva-external-link-outline"></i>'+e+"</a>"}},{name:"extra",targets:8,className:"dt-left",visible:!1,render:function(e,t,a,n){return e}}],order:[[1,"desc"]],processing:!0,serverSide:!0,ajax:o.options.ajax_url+"?action=useyourdrive-event-stats&type=full-log&detail="+a+"&id="+n+"&_ajax_nonce="+o.options.admin_nonce})},viewEntryDetails:function(e,t){let a=this;a.openModal("entry",e,t)},viewUserDetails:function(e){let t=this;t.openModal("user",e,null)},openModal:function(t,a,n){let o=this;var s=t+"-"+a,r=e("#wpcp-modal-details-template").clone();r.attr("id",s).appendTo("#wpcp");var i=r.find("#wpcp-event-details-totals");o.loadTotalsData(i,t,a),e.ajax({type:"POST",url:o.options.ajax_url,data:{action:"useyourdrive-event-stats",account_id:n,type:"get-detail",detail:t,id:a,_ajax_nonce:o.options.admin_nonce},success:function(e){switch(t){case"user":r.find(".wpcp-event-details-name").text(e.user.user_name),r.find(".wpcp-event-details-description").text(e.user.user_email),r.find(".wpcp-event-details-entry-img").attr("src",e.user.avatar),r.find(".wpcp-event-user-profile").attr("href",e.user.user_link).show(),r.find(".wpcp-event-download-entry").hide();break;case"entry":r.find(".wpcp-event-details-name").text(e.entry.entry_name),r.find(".wpcp-event-details-description").html(e.entry.entry_description),r.find(".wpcp-event-details-entry-img").attr("src",e.entry.entry_thumbnails),r.find(".wpcp-event-user-profile").attr("href","").hide(),!1===e.entry.entry_link?r.find(".wpcp-event-download-entry").show():r.find(".wpcp-event-download-entry").attr("href",e.entry.entry_link+"&_ajax_nonce="+o.options.admin_nonce)}},complete:function(){r.find(".wpcp-event-details-loader").fadeOut().prev().removeClass("opacity-0")},dataType:"json"}),r.fadeIn(),o.loadDetailedLog(r.find("#wpcp-full-detail-log"),t,a)}}),e(".wpcp-reports").wpcp_reports(UseyourDrive_Report_Vars)});